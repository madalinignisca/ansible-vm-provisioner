---

### VM

vm_box: "ubuntu/xenial64"
vm_hostname: "small.vm"
vm_memory: 1024
vm_cpus: 1

vagrant_synced_folders: []

### Important tools
git_packages:
  - git

### SWAP

swapfile_swappiness: 10
swapfile_vfs_cache_pressure: 50

### Firewall

firewall_allowed_tcp_ports:
  - "22"
  - "80"
  - "443"

### Apache HTTPD

apache_listen_port: 8080
apache_listen_port_ssl: 8443

apache_mods_enabled:
  - rewrite.load
  - expires.load
  - deflate.load
  - headers.load
  - mpm_event.load
apache_mods_disabled:
  - mpm_prefork.load
  - mpm_worker.load
  - ssl.load

apache_vhost_php_fpm_parameters: |
  <FilesMatch \.php$>
    SetHandler "proxy:fcgi://{{ php_fpm_listen }}"
  </FilesMatch>

### PHP

php_version: '7.1'

# Configure PHP paths and packages for PHP 5.6, PHP 7.0 and PHP 7.1.
php_conf_paths:
  - "/etc/php/{{ php_version }}/fpm"
  - "/etc/php/{{ php_version }}/apache2"
  - "/etc/php/{{ php_version }}/cli"
php_extension_conf_paths:
  - "/etc/php/{{ php_version }}/fpm/conf.d"
  - "/etc/php/{{ php_version }}/apache2/conf.d"
  - "/etc/php/{{ php_version }}/cli/conf.d"
php_fpm_daemon: "php{{ php_version }}-fpm"
php_fpm_conf_path: "/etc/php/{{ php_version }}/fpm"
php_fpm_pool_conf_path: "{{ php_fpm_conf_path }}/pool.d/www.conf"
php_mysql_package: "php{{ php_version }}-mysql"
php_redis_package: "php{{ php_version }}-redis"
php_memcached_package: "php{{ php_version }}-memcached"
php_pgsql_package: "php{{ php_version }}-pgsql"

php_packages:
  - "php{{ php_version }}"
  - "php{{ php_version }}-apcu"
  - "php{{ php_version }}-cli"
  - "php{{ php_version }}-common"
  - "php{{ php_version }}-curl"
  - "php{{ php_version }}-dev"
  - "php{{ php_version }}-fpm"
  - "php{{ php_version }}-gd"
  - "php{{ php_version }}-imap"
  - "php{{ php_version }}-json"
  - "php{{ php_version }}-mbstring"
  - "php{{ php_version }}-mcrypt"
  - "php{{ php_version }}-opcache"
  - "php{{ php_version }}-sqlite3"
  - "php{{ php_version }}-xml"
  - "php{{ php_version }}-yaml"

php_expose_php: "Off"
php_max_execution_time: "180"
php_max_input_vars: "8192"
php_date_timezone: "UTC"
php_output_buffering: "Off"

# Set this to false if you're not using PHP with Apache/Nginx/etc.
php_enable_webserver: true

# PHP-FPM configuration.
php_enable_php_fpm: true
php_fpm_listen: "127.0.0.1:9000"
php_fpm_listen_allowed_clients: "127.0.0.1"
php_fpm_pm_max_children: 2
php_fpm_pm_start_servers: 1
php_fpm_pm_min_spare_servers: 1
php_fpm_pm_max_spare_servers: 2

### MySQL

Memory settings (default values optimized ~128MB RAM).
mysql_key_buffer_size: "64M"
mysql_max_allowed_packet: "16M"
mysql_table_open_cache: "64"
mysql_sort_buffer_size: "1M"
mysql_read_buffer_size: "1M"
mysql_read_rnd_buffer_size: "1M"
mysql_myisam_sort_buffer_size: "8M"
mysql_thread_cache_size: "1"
mysql_query_cache_size: "16M"
mysql_query_cache_limit: "1M"
mysql_max_connections: "64"
mysql_tmp_table_size: "16M"
mysql_max_heap_table_size: "16M"

Set .._buffer_pool_size up to 80% of RAM but beware of setting too high.
mysql_innodb_buffer_pool_size: "64M"

Replication settings (replication is only enabled if master/user have values).
mysql_max_binlog_size: "10M"
mysql_expire_logs_days: "7"

# Set this to the user ansible is logging in as - should have root
# or sudo access
mysql_user_home: /home/ubuntu
mysql_user_name: ubuntu
mysql_user_password: ubuntu

# The default root user installed by mysql - almost always root
mysql_root_home: /root
mysql_root_username: root
mysql_root_password: root

# Set this to `yes` to forcibly update the root password.
mysql_root_password_update: yes
mysql_user_password_update: yes

### Varnish

varnish_listen_port: "7080"

### Nginx

nginx_ppa_use: true
nginx_package_name: "nginx-light"

nginx_extra_http_options: |
  proxy_redirect     off;
  proxy_buffering    off;
  proxy_set_header   X-Real-IP $remote_addr;
  proxy_set_header   X-Scheme $scheme;
  proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
  proxy_set_header   Host $http_host;
  proxy_set_header   X-Forwarded-Proto https;
  ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
  ssl_prefer_server_ciphers on;
  ssl_ciphers "EECDH+AESGCM:EDH+AESGCM:AES256+EECDH:AES256+EDH";
  ssl_ecdh_curve secp384r1;
  ssl_session_cache shared:SSL:10m;
  ssl_session_tickets off;
  ssl_stapling on;
  ssl_stapling_verify on;
  ssl_dhparam /etc/ssl/private/dhparams.pem;
  resolver 8.8.8.8 8.8.4.4 valid=300s;
  resolver_timeout 5s;
  add_header Strict-Transport-Security "max-age=63072000; includeSubDomains; preload";
  add_header X-Frame-Options DENY;
  add_header X-Content-Type-Options nosniff;
nginx_proxy_cache_path: "/var/cache/nginx keys_zone=cache:32m"

nginx_remove_default_vhost: true
